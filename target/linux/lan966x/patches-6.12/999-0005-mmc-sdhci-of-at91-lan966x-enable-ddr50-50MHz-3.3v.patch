From dd9e2c3a8b4d3d9d334a551831afb0e90e044055 Mon Sep 17 00:00:00 2001
From: Lars Povlsen <lars.povlsen@microchip.com>
Date: Tue, 30 Jan 2024 15:33:55 +0100
Subject: [PATCH] mmc: sdhci-of-at91: lan966x: enable ddr50 @ 50MHz, 3.3v

---
 arch/arm/boot/dts/microchip/lan966x-appl-pcb8290.dts | 1 +
 arch/arm/boot/dts/microchip/lan966x-appl-pcb8291.dts | 1 +
 arch/arm/boot/dts/microchip/lan966x-pcb8290.dts      | 1 +
 arch/arm/boot/dts/microchip/lan966x-pcb8291.dts      | 1 +
 arch/arm/boot/dts/microchip/lan966x-pcb8309.dts      | 1 +
 arch/arm/boot/dts/microchip/lan966x-pcb8385.dts      | 1 +
 arch/arm/boot/dts/microchip/lan966x.dtsi             | 2 +-
 7 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/microchip/lan966x-appl-pcb8290.dts b/arch/arm/boot/dts/microchip/lan966x-appl-pcb8290.dts
index 3f3a45528bf0..1ec7fa065523 100644
--- a/arch/arm/boot/dts/microchip/lan966x-appl-pcb8290.dts
+++ b/arch/arm/boot/dts/microchip/lan966x-appl-pcb8290.dts
@@ -117,6 +117,7 @@ &sdmmc0 {
 	pinctrl-0 = <&emmc_sd_pins>, <&emmc_pins>;
 	pinctrl-names = "default";
 	no-1-8-v;
+	mmc-ddr-3_3v;
 	tx-phase = <0>; /* 180 degrees phase shift */
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/microchip/lan966x-appl-pcb8291.dts b/arch/arm/boot/dts/microchip/lan966x-appl-pcb8291.dts
index f1359fb36b37..47cd934d4763 100644
--- a/arch/arm/boot/dts/microchip/lan966x-appl-pcb8291.dts
+++ b/arch/arm/boot/dts/microchip/lan966x-appl-pcb8291.dts
@@ -85,6 +85,7 @@ &sdmmc0 {
 	pinctrl-0 = <&emmc_sd_pins>, <&emmc_pins>;
 	pinctrl-names = "default";
 	no-1-8-v;
+	mmc-ddr-3_3v;
 	tx-phase = <0>; /* 180 degrees phase shift */
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/microchip/lan966x-pcb8290.dts b/arch/arm/boot/dts/microchip/lan966x-pcb8290.dts
index 97923dbeb241..5cea0a90d81d 100644
--- a/arch/arm/boot/dts/microchip/lan966x-pcb8290.dts
+++ b/arch/arm/boot/dts/microchip/lan966x-pcb8290.dts
@@ -224,6 +224,7 @@ &sdmmc0 {
 	pinctrl-0 = <&emmc_sd_pins>, <&emmc_pins>;
 	pinctrl-names = "default";
 	no-1-8-v;
+	mmc-ddr-3_3v;
 	tx-phase = <0>; /* 180 degrees phase shift */
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/microchip/lan966x-pcb8291.dts b/arch/arm/boot/dts/microchip/lan966x-pcb8291.dts
index 108db2916a19..2453aba98872 100644
--- a/arch/arm/boot/dts/microchip/lan966x-pcb8291.dts
+++ b/arch/arm/boot/dts/microchip/lan966x-pcb8291.dts
@@ -176,6 +176,7 @@ &sdmmc0 {
 	pinctrl-0 = <&emmc_sd_pins>, <&emmc_pins>;
 	pinctrl-names = "default";
 	no-1-8-v;
+	mmc-ddr-3_3v;
 	tx-phase = <0>; /* 180 degrees phase shift */
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/microchip/lan966x-pcb8309.dts b/arch/arm/boot/dts/microchip/lan966x-pcb8309.dts
index 7074a7744c80..6b8c9d934170 100644
--- a/arch/arm/boot/dts/microchip/lan966x-pcb8309.dts
+++ b/arch/arm/boot/dts/microchip/lan966x-pcb8309.dts
@@ -270,6 +270,7 @@ &sdmmc0 {
 	pinctrl-0 = <&emmc_sd_pins>, <&emmc_pins>;
 	pinctrl-names = "default";
 	no-1-8-v;
+	mmc-ddr-3_3v;
 	tx-phase = <0>; /* 180 degrees phase shift */
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/microchip/lan966x-pcb8385.dts b/arch/arm/boot/dts/microchip/lan966x-pcb8385.dts
index 71c21846abcc..524b3098172c 100644
--- a/arch/arm/boot/dts/microchip/lan966x-pcb8385.dts
+++ b/arch/arm/boot/dts/microchip/lan966x-pcb8385.dts
@@ -235,6 +235,7 @@ &sdmmc0 {
 	pinctrl-0 = <&emmc_sd_pins>, <&emmc_pins>;
 	pinctrl-names = "default";
 	no-1-8-v;
+	mmc-ddr-3_3v;
 	tx-phase = <0>; /* 180 degrees phase shift */
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/microchip/lan966x.dtsi b/arch/arm/boot/dts/microchip/lan966x.dtsi
index fee2e692db74..9fd0be8c5c0d 100644
--- a/arch/arm/boot/dts/microchip/lan966x.dtsi
+++ b/arch/arm/boot/dts/microchip/lan966x.dtsi
@@ -563,7 +563,7 @@ sdmmc0: sdio-host@e0830000 {
 			clocks = <&clks GCK_ID_SDMMC0>, <&clks GCK_ID_SDMMC0>;
 			clock-names = "hclock", "multclk";
 			assigned-clocks = <&clks GCK_ID_SDMMC0>;
-			assigned-clock-rates = <45000000>;
+			assigned-clock-rates = <50000000>;
 			status = "disabled";
 		};
 
-- 
2.43.0

